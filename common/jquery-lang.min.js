!function(t){"use strict";var e,n;"function"==typeof define&&define.amd?define(["jquery","Cookies"],t):"object"==typeof exports?module.exports=t():(e=window.Lang,(n=window.Lang=t(jQuery,"undefined"!=typeof Cookies?Cookies:void 0)).noConflict=function(){return window.Lang=e,n})}(function(h,l){function t(){this._fireEvents=!0,this._dynamic={}}return t.prototype.init=function(t){var e,n,a,o=this;(t=t||{}).cookie=t.cookie||{},e=t.defaultLang,n=t.currentLang,a=t.allowCookieOverride,this.cookieName=t.cookie.name||"langCookie",this.cookieExpiry=t.cookie.expiry||365,this.cookiePath=t.cookie.path||"/",this._mutationCopies={append:h.fn.append,appendTo:h.fn.appendTo,prepend:h.fn.prepend,before:h.fn.before,after:h.fn.after,html:h.fn.html},h.fn.append=function(){return o._mutation(this,"append",arguments)},h.fn.appendTo=function(){return o._mutation(this,"appendTo",arguments)},h.fn.prepend=function(){return o._mutation(this,"prepend",arguments)},h.fn.before=function(){return o._mutation(this,"before",arguments)},h.fn.after=function(){return o._mutation(this,"after",arguments)},h.fn.html=function(){return o._mutation(this,"html",arguments)},this.defaultLang=e||"en",this.currentLang=e||"en",!a&&n||void 0===l||(t=l.get(this.cookieName))&&(n=t),h(function(){o._start(),n&&n!==o.defaultLang&&o.change(n)})},t.prototype.pack={},t.prototype.attrList=["title","alt","placeholder","href"],t.prototype.dynamic=function(t,e){void 0!==t&&void 0!==e&&(this._dynamic[t]=e)},t.prototype.loadPack=function(o,i){var r=this;if(!o||!r._dynamic[o])throw"Cannot load language pack, no file path specified!";fetch(r._dynamic[o]).then(function(t){if(t.ok)return t.json()}).then(function(t){if(r.pack[o]=t,r.pack[o].regex)for(var e,n=r.pack[o].regex,a=0;a<n.length;a++)2===(e=n[a]).length?e[0]=new RegExp(e[0]):3===e.length&&(e[0]=new RegExp(e[0],e[1]),e.splice(1,1));i&&i(!1,o,r._dynamic[o])}).catch(function(t){throw i&&i(!0,o,r._dynamic[o]),"Error loading language pack"+r._dynamic[o]})},t.prototype._start=function(t){for(var e,n=void 0!==t?h(t).find("[lang]"):h(":not(html)[lang]"),a=n.length;a--;)e=h(n[a]),this._processElement(e)},t.prototype._processElement=function(t){t.attr("lang")===this.defaultLang&&(this._storeAttribs(t),this._storeContent(t))},t.prototype._storeAttribs=function(t){for(var e,n,a=0;a<this.attrList.length;a++)e=this.attrList[a],t.attr(e)&&((n=t.data("lang-attr")||{})[e]=t.attr(e),t.data("lang-attr",n))},t.prototype._storeContent=function(t){var e;if(t.is("input"))switch(t.attr("type")){case"button":case"submit":case"hidden":case"reset":t.data("lang-val",t.val())}else t.is("img")?t.data("lang-src",t.attr("src")):(e=this._getTextNodes(t))&&t.data("lang-text",e)},t.prototype._getTextNodes=function(t){var n,t=t.contents(),a=[];Array.prototype.map;return h.each(t,function(t,e){3===e.nodeType&&(n={node:e,langDefaultText:e.data},a.push(n))}),t.length,a},t.prototype._setTextNodes=function(t,e,n){for(var a,o,i,r=n!==this.defaultLang,s=0;s<e.length;s++)if(a=e[s],r){if(o=a.langToken||h.trim(a.langDefaultText))if(i=this.translate(o,n))try{a.node.data=a.node.data.split(h.trim(a.node.data)).join(i)}catch(t){}else console&&console.log&&console.log('Translation for "'+o+'" not found!')}else try{a.node.data=a.langDefaultText}catch(t){}},t.prototype._translateAttribs=function(t,e){var n,a,o=t.data("lang-attr")||{};for(n in o)o.hasOwnProperty(n)&&t.attr(n)&&(e!==this.defaultLang?(a=this.translate(o[n],e))&&t.attr(n,a):t.attr(n,o[n]))},t.prototype._translateContent=function(t,e){var n,a,o=e!==this.defaultLang;if(t.is("input"))switch(t.attr("type")){case"button":case"submit":case"hidden":case"reset":o?(n=this.translate(t.data("lang-val"),e))&&t.val(n):t.val(t.data("lang-val"))}else t.is("img")?o?(n=this.translate(t.data("lang-src"),e))&&t.attr("src",n):t.attr("src",t.data("lang-src")):(a=t.data("lang-text"))&&this._setTextNodes(t,a,e)},t.prototype.change=function(a,o,i){var r=this;if(a!==this.defaultLang&&!this.pack[a]&&!this._dynamic[a])throw i&&i("No language pack defined for: "+a,a,o),'Attempt to change language to "'+a+'" but no language pack for that language is loaded!';if(a!==this.defaultLang){if(!this.pack[a]&&this._dynamic[a])return void this.loadPack(a,function(t,e,n){t?i&&i("Language pack could not load from: "+n,a,o):r.change.call(r,a,o,i)});if(!this.pack[a]&&!this._dynamic[a])throw i&&i("Language pack not defined for: "+a,a,o),"Could not change language to "+a+" because no language pack for this language exists!"}for(var t,e=!1,n=this.currentLang,s=(this.currentLang!=a&&(this.beforeUpdate(n,a),e=!0),this.currentLang=a,void 0!==o?h(o).find("[lang]"):h(":not(html)[lang]")),c=s.length;c--;)(t=h(s[c])).attr("lang")!==a&&this._translateElement(t,a);e&&this.afterUpdate(n,a),void 0!==l&&l.set(r.cookieName,a,{expires:r.cookieExpiry,path:r.cookiePath}),i&&i(!1,a,o)},t.prototype._translateElement=function(t,e){this._translateAttribs(t,e),"false"!=t.attr("data-lang-content")&&this._translateContent(t,e),t.attr("lang",e)},t.prototype.translate=function(t,e){var n;return e=e||this.currentLang,this.pack[e]?(n="",e!=this.defaultLang?((n=(n=this.pack[e].token[t])||this._regexMatch(t,e))||console4jslang&&console&&console.log&&console.log('Translation for "'+t+'" not found in language pack: '+e),n||t):t):t},t.prototype._regexMatch=function(t,e){var n,a,o,i,r,s=this.pack[e].regex;if(s)for(n=s.length,a=0;a<n;a++)if((r=(i=(o=s[a])[0]).exec(t))&&r[0])return t.replace(i,o[1]);return""},t.prototype.beforeUpdate=function(t,e){this._fireEvents&&h(this).triggerHandler("beforeUpdate",[t,e,this.pack[t],this.pack[e]])},t.prototype.afterUpdate=function(t,e){this._fireEvents&&h(this).triggerHandler("afterUpdate",[t,e,this.pack[t],this.pack[e]])},t.prototype.refresh=function(){this._fireEvents=!1,this.change(this.currentLang),this._fireEvents=!0},t.prototype._mutation=function(t,e,n){e=this._mutationCopies[e].apply(t,n),n=this.currentLang,t=h(t);return t.attr("lang")&&(this._fireEvents=!1,this._translateElement(t,this.defaultLang),this.change(this.defaultLang,t),this.currentLang=n,this._processElement(t),this._translateElement(t,this.currentLang)),this._start(t),this.change(this.currentLang,t),this._fireEvents=!0,e},t});